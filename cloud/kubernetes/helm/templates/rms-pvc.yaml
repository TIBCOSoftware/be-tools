#
# Copyright (c) 2019-2020. TIBCO Software Inc.
# This file is subject to the license terms contained in the license file that is distributed with this file.
#


{{- if and (eq .Values.bsType "sharednothing") (eq .Values.volumes.pvProvisioningMode "static") (eq .Values.cpType "aws") }}
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: "{{ .Release.Name }}-be-pvc-{{ .Values.volumes.snmountVolume }}"
spec:
  storageClassName: "{{  .Values.volumes.storageClass }}"
  accessModes: 
    - {{ .Values.volumes.accessModes }}
  resources:
    requests:
      storage: {{ .Values.volumes.storage }}
{{- end -}}


{{- if and (eq .Values.mountLogs true) (eq .Values.volumes.pvProvisioningMode "static") (eq .Values.cpType "aws") }}
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: "{{ .Release.Name }}-be-pvc-{{ .Values.volumes.logmountVolume }}"
spec:
  storageClassName: "{{  .Values.volumes.storageClass }}"
  accessModes: 
    - {{ .Values.volumes.accessModes }}
  resources:
    requests:
      storage: {{ .Values.volumes.storage }}
{{- end -}}


{{- if eq .Values.rms.enabled true }}
{{- $scName  :=  .Values.volumes.storageClass -}}
{{- $scStorage  :=  .Values.volumes.storage -}}
{{- $accessmodes:= .Values.volumes.accessModes -}}
{{- $releasename:= .Release.Name  -}}
{{- range tuple "security" "notify" "webstudio" "shared" }}
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: "{{ $releasename}}-rms-pvc-{{.}}"
spec:
  storageClassName: "{{ $scName }}"
  accessModes:
    - {{ $accessmodes }}
  resources:
    requests:
      storage: {{ $scStorage }}
{{- end }}
{{- end -}}


{{- if and ( eq .Values.rms.persistenceType "sharednothing" ) ( eq .Values.rms.enabled true ) }}
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: "{{ .Release.Name }}-rms-pvc-{{ .Values.volumes.snmountVolume }}"
spec:
  storageClassName: "{{  .Values.volumes.storageClass }}"
  accessModes: 
    - {{ .Values.volumes.accessModes }}
  resources:
    requests:
      storage: {{ .Values.volumes.storage }}
{{- end -}}


{{- if and ( eq .Values.mountLogs true ) ( eq .Values.rms.enabled true ) }}
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: "{{ .Release.Name }}-rms-pvc-{{ .Values.volumes.logmountVolume }}"
spec:
  storageClassName: "{{  .Values.volumes.storageClass }}"
  accessModes: 
    - {{ .Values.volumes.accessModes }}
  resources:
    requests:
      storage: {{ .Values.volumes.storage }}
{{- end -}}

{{- if and ( eq .Values.mountLogs true ) ( eq .Values.tea.enabled true ) }}
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: "{{ .Release.Name }}-tea-pvc-{{ .Values.volumes.logmountVolume }}"
spec:
  storageClassName: "{{  .Values.volumes.storageClass }}"
  accessModes: 
    - {{ .Values.volumes.accessModes }}
  resources:
    requests:
      storage: {{ .Values.volumes.storage }}
{{- end -}}