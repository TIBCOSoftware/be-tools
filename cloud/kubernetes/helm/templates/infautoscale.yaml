{{- if or ( eq .Values.inferencenode.hpa.cpu.enabled true ) ( eq .Values.inferencenode.hpa.memory.enabled true ) }}
{{- if or (eq .Values.cmType "as2" ) (eq .Values.cmType "ftl" ) (eq .Values.cmType "unclustered" ) (eq .Values.cmType "ignite" ) }}
apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: "{{ include "beinferenceagent.fullname" . }}-hpa"
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: StatefulSet
    name: "{{ include "beinferenceagent.fullname" . }}"
  minReplicas: {{ .Values.inferencenode.replicaCount }}
  maxReplicas: {{ .Values.inferencenode.hpa.maxReplicas }}
  metrics:
  {{- if eq .Values.inferencenode.hpa.cpu.enabled true }}
  - type: {{ .Values.inferencenode.hpa.type }}
    resource:
      name: {{ .Values.inferencenode.hpa.cpu.resourceName }}
      target:
        type: {{ .Values.inferencenode.hpa.cpu.resourceTargetType }}
        averageUtilization: {{ .Values.inferencenode.hpa.cpu.averageUtilization }}
  {{- end }}
  {{- if eq .Values.inferencenode.hpa.memory.enabled true }}
  - type: {{ .Values.inferencenode.hpa.type }}
    resource:
      name: {{ .Values.inferencenode.hpa.memory.resourceName }}
      target:
        type: {{ .Values.inferencenode.hpa.memory.resourceTargetType }}
        averageUtilization: {{ .Values.inferencenode.hpa.memory.averageUtilization }}
  {{- end }}
{{- end }}
{{- end -}}